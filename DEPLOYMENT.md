# Deployment Guide - DokterBubung Full Stack

## Overview
Deploy Golang backend ke Railway dan Next.js frontend ke Vercel dengan environment variables yang tepat.

---

## Part 1: Backend Deployment (Railway)

### 1. Push Code to GitHub
```bash
cd backend
git add .
git commit -m "feat: DokterBubung Hospital Management System"
git push origin main
```

### 2. Deploy to Railway
1. Go to [railway.app](https://railway.app)
2. Click "New Project" â†’ "Deploy from GitHub repo"
3. Select your repository
4. Railway auto-detects Golang project

### 3. Add PostgreSQL Database
1. Click "New" â†’ "Database" â†’ "PostgreSQL"
2. Railway auto-creates `DATABASE_URL` variable
3. Link database to your backend service

### 4. Configure Environment Variables
Di Railway dashboard bagian "Variables":
```
DATABASE_URL=(auto-generated by Railway)
JWT_SECRET=your-super-secret-jwt-key-here
PORT=8080
```

### 5. Deploy Settings
Railway auto-detects:
- **Build Command**: `go build -o main cmd/main.go`
- **Start Command**: `./main`

Click "Deploy" dan tunggu build selesai.

### 6. Get Railway URL
Setelah deploy sukses, copy Railway URL:
```
https://your-app.railway.app
```

### 7. Test Backend
```bash
curl https://your-app.railway.app/api/hospital/medicines
curl https://your-app.railway.app/api/hospital/patients
```

---

## Part 2: Frontend Deployment (Vercel)

### 1. Update API Configuration
File: `frontend/src/app/dokterbubung/utils/api.ts`
```typescript
// Already updated to:
const API_BASE_URL = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8080/api/hospital';
```

### 2. Create `.env.local` for Local Development
```bash
cd frontend
echo "NEXT_PUBLIC_API_URL=http://localhost:8080/api/hospital" > .env.local
```

### 3. Push to GitHub
```bash
git add .
git commit -m "feat: DokterBubung frontend with backend integration"
git push origin main
```

### 4. Deploy to Vercel
1. Go to [vercel.com](https://vercel.com)
2. Click "Add New" â†’ "Project"
3. Import your GitHub repository
4. Vercel auto-detects Next.js

### 5. Configure Environment Variables
Di Vercel project settings â†’ "Environment Variables":

**Production:**
```
NEXT_PUBLIC_API_URL=https://your-app.railway.app/api/hospital
```

**Preview/Development:** (optional)
```
NEXT_PUBLIC_API_URL=http://localhost:8080/api/hospital
```

### 6. Deploy Settings (Auto-detected)
- **Framework Preset**: Next.js
- **Build Command**: `npm run build`
- **Output Directory**: `.next`
- **Install Command**: `npm install`

Click "Deploy" dan tunggu build selesai.

### 7. Get Vercel URL
```
https://your-app.vercel.app
```

### 8. Test Full Stack
1. Buka: `https://your-app.vercel.app/dokterbubung`
2. Click role card (Dokter/Apoteker/Logistik)
3. Verify data loads from Railway backend
4. Test create prescription, add patient, restock

---

## Part 3: CORS Configuration (Important!)

### Update Backend CORS
File: `backend/cmd/main.go`

Jika ada error CORS, update config:
```go
app.Use(cors.New(cors.Config{
    AllowOrigins: "https://your-app.vercel.app, http://localhost:3000",
    AllowMethods: "GET,POST,PUT,DELETE",
    AllowHeaders: "Origin, Content-Type, Accept",
}))
```

Atau allow all (untuk development):
```go
app.Use(cors.New()) // Default allows all origins
```

---

## Troubleshooting

### Backend Issues

**Error: PreparedStatement already exists**
âœ… Fixed with `PrepareStmt: false` in GORM config

**Error: Database connection failed**
- Check `DATABASE_URL` in Railway variables
- Ensure PostgreSQL service is linked

**Error: Build failed**
- Verify `cmd/main.go` includes all functions
- Check `go.mod` dependencies

### Frontend Issues

**Error: Failed to fetch**
- Check `NEXT_PUBLIC_API_URL` in Vercel
- Verify Railway backend is running
- Check browser console for CORS errors

**Error: 404 on routes**
- Ensure all route pages exist
- Check Next.js build logs

**Data not loading**
- Open browser DevTools â†’ Network tab
- Verify API calls to Railway URL
- Check API response status codes

---

## Environment Variables Summary

### Railway (Backend)
```
DATABASE_URL=postgresql://...
JWT_SECRET=your-secret-key
PORT=8080
```

### Vercel (Frontend)
```
NEXT_PUBLIC_API_URL=https://your-app.railway.app/api/hospital
```

---

## Testing Full Workflow

1. **Doctor Flow:**
   - Open `/dokterbubung/dokter/workstation`
   - Add patient â†’ Create prescription
   - Check prescription in `/dokter/history`

2. **Pharmacist Flow:**
   - Open `/dokterbubung/apoteker/verification`
   - Process prescription (stock reduces)
   - Move to `/apoteker/pickup` and finish

3. **Logistics Flow:**
   - Open `/dokterbubung/logistik/inventory`
   - Restock low stock items
   - Check logs in `/logistik/logs`

4. **Public Display:**
   - Open `/dokterbubung/antrean`
   - Verify prescription status shows correctly

---

## URLs Reference

**Local Development:**
- Frontend: `http://localhost:3000/dokterbubung`
- Backend: `http://localhost:8080/api/hospital`

**Production:**
- Frontend: `https://your-app.vercel.app/dokterbubung`
- Backend: `https://your-app.railway.app/api/hospital`

---

## Quick Deploy Commands

```bash
# Backend
cd backend
git add .
git commit -m "deploy: backend to railway"
git push origin main

# Frontend  
cd frontend
git add .
git commit -m "deploy: frontend to vercel"
git push origin main
```

Railway dan Vercel akan auto-deploy saat detect push ke GitHub! ðŸš€
